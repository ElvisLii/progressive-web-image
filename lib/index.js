!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("mini-progressive-image",[],t):"object"==typeof exports?exports["mini-progressive-image"]=t():e.miniPi=t()}(this,(function(){return(()=>{"use strict";var e={d:(t,i)=>{for(var n in i)e.o(i,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:i[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{ProgressiveImage:()=>i});class i{constructor(e){this.el=e.el||document,this.lazyClass=e.lazyClass||"lazy",this.removePreview=!1,this.scale=e.scale,this.events=["scroll","resize"],this.windowIsBind=!1,this.animationEvent=this.getAnimationEvent(),this.lazy=function(e,t=300){let i=0;return()=>{Date.now()-i>=t&&(i=Date.now(),e.call(this))}}((()=>{this.fire()}))}fire(){this.windowIsBind||(this.windowIsBind=!0,this.bindEvent(window,!0));const e=document.querySelectorAll(`${this.el} img.${this.lazyClass}`);if(e.length>0)for(let t=0;t<e.length;t++){const i=e[t].getBoundingClientRect();i.top<window.innerHeight&&i.bottom>0&&this.loadImage(e[t])}}loadImage(e){const t=new Image;t.src=e.dataset.src,t.className="origin",this.scale&&t.classList.add("origin-scale"),t.onload=()=>{this.mountImage(e,t)},e.classList.remove(`${this.lazyClass}`)}mountImage(e,t){const i=e.parentNode;i.appendChild(t).addEventListener(this.animationEvent,(t=>{this.removePreview&&(i.removeChild(e),t.target.classList.remove("origin","origin-scale"))}))}getAnimationEvent(){const e=document.createElement("fa"),t={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"animationend",WebkitAnimation:"webkitAnimationEnd"};for(const i in t)if(void 0!==e.style[i])return t[i]}bindEvent(e,t){t?this.events.forEach((t=>{!function(e,t,i){e.addEventListener(t,i)}(e,t,this.lazy)})):this.events.forEach((t=>{!function(e,t,i){e.removeEventListener(t,i)}(e,t,this.lazy)}))}}return t})()}));